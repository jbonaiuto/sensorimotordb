{% extends "base_popup.html" %}
{% load staticfiles %}
{% block extrahead %}
<title>SensoriMotorDB - Create ANOVA</title>
<script type="text/javascript" src="{% static 'sensorimotordb/js/jquery-1.10.1.js' %}"></script>
<script type="text/javascript" src="{% static 'sensorimotordb/js/underscore-min.js' %}"></script>
<script type="text/javascript">
    var numFactors=0;

    function addFactor()
    {
        var tmplMarkup = $('#anova_factor-template').html();
        var data={
            idx: $('#id_factors').children().length,
            anova_id: '',
            id: ''
        };
        var compiledTmpl = _.template(tmplMarkup, data);
        $('#id_factors').append(compiledTmpl);
        $('#id_factor-TOTAL_FORMS').val(parseInt($('#id_factor-TOTAL_FORMS').val())+1);
        numFactors=numFactors+1;
        if(numFactors>=3)
        {
            $('#id_add_factor').prop('disabled',true);
        }
    }

    function removeFactor(factor_idx)
    {
        $('#id_anova_factor-'+factor_idx).hide();
        $('#id_factor-'+factor_idx+'-DELETE').val(true);
        numFactors=numFactors-1;
        $('#id_add_factor').prop('disabled',false);
    }

    function addFactorLevel(factor_idx)
    {
        var tmplMarkup = $('#anova_factor_level-template').html();
        var data={
            factor_idx: factor_idx,
            idx: $('#id_factor-'+factor_idx+'_levels').children().length,
            factor_id: '',
            id: ''
        }
        var compiledTmpl = _.template(tmplMarkup, data);
        $('#id_factor-'+factor_idx+'_levels').append(compiledTmpl);
        $('#id_factor-'+factor_idx+'-anova_factor_levels-TOTAL_FORMS').val(parseInt($('#id_factor-'+factor_idx+'-anova_factor_levels-TOTAL_FORMS').val())+1);
    }

    function removeFactorLevel(factor_idx, level_idx)
    {
        $('#id_anova_factor-'+factor_idx+'_level-'+level_idx).hide();
        $('#id_factor-'+factor_idx+'-anova_factor_levels-'+level_idx+'-DELETE').val(true);
    }
</script>
{% endblock %}
{% block content %}
<h2>New ANOVA</h2>
<form id="anovaForm" method="post" action="" enctype="multipart/form-data">
    {% csrf_token %}
    <table>
        <tr>
            <th><strong>{{ form.name.label_tag }}</strong></th>
            <td>{{ form.name }}</td>
        </tr>
        <tr>
            <th><strong>{{ form.dependent_variable.label_tag }}</strong></th>
            <td>{{ form.dependent_variable }}</td>
        </tr>
    </table>
    {{ form.analysis }}

    <h2>Factors <input id="id_add_factor" type="button" onclick="return addFactor();" value="Add"/></h2>
    {{ factor_level_formset.management_form }}
    <div id="id_factors">
    </div>

    <input type="submit" value="Save" />
</form>
{% include "sensorimotordb/analysis/classification_analysis/anova_factor_list_item_edit_template.html" %}
{% include "sensorimotordb/analysis/classification_analysis/anova_factor_level_list_item_edit_template.html" %}
{% endblock %}
